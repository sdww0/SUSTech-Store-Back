<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.susstore.mapper.GoodsMapper" >

    <insert id="addGoods" parameterType="Goods" useGeneratedKeys="true" keyProperty="goodsId">
        insert into store."goods"
            (title,price,introduce,announcer_id,want,
             announce_time,goods_state,picture_amount,is_sell)
        values (#{title},#{price},#{introduce},#{announcer.userId},
                #{want},#{announceTime},#{goodsState},
                #{pictureAmount},#{isSell})
                returning goods_id;
    </insert>

    <update id="updateGoods" parameterType="Goods">
        update store."goods"
        <set>
            <if test="price != null"> price=#{price},</if>
            <if test="introduce != null">introduce=#{introduce},</if>
            <if test="announcer != null">announcer_id=#{announcer.userId},</if>
            <if test="want != null">want=#{want},</if>
            <if test="announceTime != null">announce_time=#{announceTime},</if>
            <if test="goodsState != null">goods_state=#{goodsState},</if>
            <if test="pictureAmount != null">picture_amount=#{pictureAmount},</if>
            <if test="title != null">title=#{title},</if>
            <if test="isSell != null">is_sell=#{isSell}</if>
        </set>
        where goods_id=#{goodsId}
    </update>


    <delete id="deleteGoods" parameterType="int">
        delete from store."goods" where goods_id=#{id}
    </delete>

    <select id="queryGoodsById" parameterType="int" resultType="Goods">
        select * from store."goods" where goods_id=#{id};
    </select>

    <select id="queryGoodsByUserId" parameterType="int" resultType="GoodsAbbreviation">
        select * from store."goods"
        where store."goods".announcer_id= #{userId};
    </select>

    <select id="getBelongUserId" parameterType="int" resultType="int">
        select store."users".user_id from
                    store."goods" join store."users"
                    on store."goods".announcer_id=store."users".user_id
        where store."goods".goods_id= #{goodsId};
    </select>
    
    <select id="searchGoods" parameterType="map" resultType="GoodsAbbreviation">
        select * from store.goods where title like concat('%',#{searchContent,jdbcType=VARCHAR},'%')
        order by goods_id limit #{pageSize} offset (${pageSize}*(${pageIndex}-1))
    </select>

    <select id="ifOnShelfById" resultType="int">
        select goods_state from store.goods where goods_id=#{goodsId}
    </select>

</mapper>